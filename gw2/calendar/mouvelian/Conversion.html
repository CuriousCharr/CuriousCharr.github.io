<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Mouvelian Date Conversions</title>
		<script src="Mouvelian.js"></script>
	</head>
	<body>
		<div id="page-root" align="center">
			<div id="navigation">
				<p>
					<input type="button" value="Gregorian -> Mouvelian" onclick="setupGregToMouv();">
					<input type="button" value="Mouvelian -> Gregorian" onclick="setupMouvToGreg();">
				</p>
			</div>
			<div id="in-out-put">
				<form autocomplete="off">
					<input id="DateInput" autofocus>
				</form>
				<p id="DateOutput"></p>
			</div>
		</div>
		<script>
			const gregToMouvFrag = "#gregorian-to-mouvelian";
			const mouvToGregFrag = "#mouvelian-to-gregorian";
			var fragment = window.location.hash;
			switch (fragment) {
			case mouvToGregFrag:
				setupMouvToGreg();
				break;
			case gregToMouvFrag:
			default:
				setupGregToMouv();
				break;
			}
			function setupGregToMouv() {
				window.location.assign(gregToMouvFrag);
				
				var now = new Date();
				var dateIn = document.getElementById("DateInput");
				var dateOut = document.getElementById("DateOutput");
				var formatExamplePlaceholder = now.getFullYear() + "-" + (now.getMonth()+1) + "-" + now.getDate();
				dateIn.placeholder = formatExamplePlaceholder;
				dateIn.value = formatExamplePlaceholder;
				
				dateIn.onkeyup = function() {
					var dateInText = dateIn.value;
					var gDateParts = dateInText.split("-");
					if (gDateParts.length === 3) {
						try {
							var result = MouvelianDate.fromGregorianDate(new GregorianDate(parseInt(gDateParts[2]), parseInt(gDateParts[1]-1), parseInt(gDateParts[0])));
							dateOut.textContent = result.day + " " + result.seasonName() + " " + result.year;
							return;
						} catch (err) {
							if (err.hasOwnProperty("prettyMessage")) {
								dateOut.textContent = err.prettyMessage;
								return;
							}
						}
					}
					dateOut.textContent = "Unrecognized Date.";
				}
				
				var result = MouvelianDate.fromDate(now);
				dateOut.textContent = result.day + " " + result.seasonName() + " " + result.year;
			}
			function setupMouvToGreg() {
				window.location.assign(mouvToGregFrag);
				
				var now = MouvelianDate.today();
				var dateIn = document.getElementById("DateInput");
				var dateOut = document.getElementById("DateOutput");
				var formatExamplePlaceholder = now.day + " " + now.seasonName() + " " + now.year;
				dateIn.placeholder = formatExamplePlaceholder;
				dateIn.value = formatExamplePlaceholder;
				
				dateIn.onkeyup = function() {
					var dateInText = dateIn.value;
					var gDateParts = dateInText.split(" ");
					if (gDateParts.length === 3) {
						try {
							var mSeason = NaN;
							var seasonNameToSeason = {
								"ZEPHYR": 0,
								"PHOENIX": 1,
								"SCION": 2,
								"COLOSSUS": 3
							};
							var lowerCasedSeason = gDateParts[1].toUpperCase();
							if (lowerCasedSeason.length !== 0) {
								for (var seasonName in seasonNameToSeason) {
									if (seasonName.startsWith(lowerCasedSeason)) {
										mSeason = seasonNameToSeason[seasonName];
										break;
									}
								}
							}
							var mDate = new MouvelianDate(parseInt(gDateParts[0]), mSeason, parseInt(gDateParts[2]));
							var result = GregorianDate.fromMouvelianDate(mDate);
							if (result.isLeapYear()) {
								var mLeapDay = MouvelianDate.fromGregorianDate(new GregorianDate(29, FEBRUARY, result.year));
								if (mDate.equals(mLeapDay)) {
									dateOut.textContent = result.year + "-" + (result.month+1) + "-" + result.day + " or " + result.year + "-" + (result.month+1) + "-" + (result.day+1);
									return;
								}
							}
							dateOut.textContent = result.year + "-" + (result.month+1) + "-" + result.day;
							return;
						} catch (err) {
							if (err.hasOwnProperty("prettyMessage")) {
								dateOut.textContent = err.prettyMessage;
								return;
							}
						}
					}
					dateOut.textContent = "Unrecognized Date.";
				}
				
				var result = GregorianDate.fromMouvelianDate(now);
				dateOut.textContent = result.year + "-" + (result.month+1) + "-" + result.day;
			}
		</script>
	</body>
</html>